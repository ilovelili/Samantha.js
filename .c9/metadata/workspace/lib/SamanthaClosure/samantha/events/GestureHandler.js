{"filter":false,"title":"GestureHandler.js","tooltip":"/lib/SamanthaClosure/samantha/events/GestureHandler.js","undoManager":{"mark":51,"position":51,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":159,"column":0},"action":"insert","lines":["// Copyright 2012 Tart. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.","","/**"," * @fileoverview GestureHandler adds the ability to capture gesture events on touch enabled devices."," * It listens to 'touchstart', 'touchmove' and 'touchend' events and generates 'tap' or 'swipe' events with"," * inherent heuristics."," *"," * Currently, the tap algorithm begins with a touchstart, checks for touchend. Any touchmove greater than 3px"," * cancels the tap event, and if a touchend is captured without a touchmove after a touchstart;"," * it's registered as a tap, and the GestureHandler dispatches a tap event on the touchend target."," *"," * Swipe up, left, right and down gestures are also supported."," *"," * Example usage:"," *"," * goog.events.listen(document.body, tart.events.EventType.TAP, function() {"," *     console.log('tapped!');"," * });"," *"," */","","goog.provide('tart.events.GestureHandler');","goog.require('goog.dom');","goog.require('goog.events.EventTarget');","goog.require('goog.math.Coordinate');","","","","/**"," * Tracks and fires gestures on touch enabled devices."," *"," * @constructor"," * @param {Element=} opt_el Provided, gesture handler will track gesture events on this element. The default"," *                          value is document.body; but an optional root element is inevitable for iframe's."," */","tart.events.GestureHandler = function(opt_el) {","    this.el = opt_el || document.body;","","    goog.events.listen(this.el, goog.events.EventType.TOUCHSTART, this.onTouchstart, false, this);","    goog.events.listen(this.el, goog.events.EventType.TOUCHMOVE, this.onTouchmove, false, this);","    goog.events.listen(this.el, goog.events.EventType.TOUCHEND, this.onTouchend, false, this);","};","goog.addSingletonGetter(tart.events.GestureHandler);","","","/**"," * iOS 6.0(+?) requires the target element to be manually derived."," * @type {?boolean}"," */","tart.events.GestureHandler.prototype.deviceIsIOSWithBadTarget = navigator.userAgent.match(/iPhone/i) &&","    (/OS ([6-9]|\\d{2})_\\d/).test(navigator.userAgent);","","","tart.events.GestureHandler.prototype.onTouchstart = function(e) {","    this.isInMotion = true;","    this.canTap = true;","    this.canSwipe = true;","","    var browserEvent = e.getBrowserEvent();","    var changedTouch = browserEvent.changedTouches[0];","","    this.touches = [browserEvent.timeStamp, changedTouch.pageX, changedTouch.pageY];","};","","","tart.events.GestureHandler.prototype.onTouchmove = function(e) {","    var touches = this.touches,","        browserEvent = e.getBrowserEvent(),","        changedTouch = browserEvent.changedTouches[0];","","    if (Math.abs(changedTouch.pageX - touches[1]) > 20 ||","        Math.abs(changedTouch.pageY - touches[2]) > 20)","        this.canTap = false;","","    if (this.canSwipe) {","        touches.push(browserEvent.timeStamp, changedTouch.pageX, changedTouch.pageY);","        if (+new Date() > touches[0] + 100) {","            this.canSwipe = false;","            return;","        }","","        // Filter the touches","        var date = browserEvent.timeStamp;","        touches = goog.array.filter(touches, function(touch, index, arr) {","            var relatedTimeStamp = arr[index - (index % 3)];","            return relatedTimeStamp > date - 250;","        });","","","        if ((touches.length / 3) > 1) {","            var firstTouch = new goog.math.Coordinate(touches[1], touches[2]);","            var lastTouch = new goog.math.Coordinate(touches[touches.length - 2],","                touches[touches.length - 1]);","","            // calculate distance. must be min 60px","            var distance = goog.math.Coordinate.distance(firstTouch, lastTouch);","            if (distance < 60) return;","","            // calculate angle.","            var angle = goog.math.angle(firstTouch.x, firstTouch.y, lastTouch.x, lastTouch.y);","","            var eventType = tart.events.EventType.SWIPE_RIGHT;","            if (angle > 45 && angle < 135) {","                eventType = tart.events.EventType.SWIPE_DOWN;","            }","            else if (angle > 135 && angle < 225) {","                eventType = tart.events.EventType.SWIPE_LEFT;","            }","            else if (angle > 225 && angle < 315) {","                eventType = tart.events.EventType.SWIPE_UP;","            }","","            var swipe = document.createEvent(\"Event\");","            swipe.initEvent(eventType, true, true);","            e.target.dispatchEvent(swipe);","","            this.canSwipe = false;","        }","    }","};","","","tart.events.GestureHandler.prototype.onTouchend = function(e) {","    this.isInMotion = false;","    if (this.canTap) {","        var touches = this.touches,","            browserEvent = e.getBrowserEvent(),","            changedTouch = browserEvent.changedTouches[0];","","        if (Math.abs(changedTouch.pageX - touches[1]) > 20 ||","            Math.abs(changedTouch.pageY - touches[2]) > 20) {","            this.canTap = false;","            return;","        }","","        var tap = document.createEvent(\"Event\");","        tap.initEvent(tart.events.EventType.TAP, true, true);","","        // Target element fix for iOS6+","        var targetElement = e.target;","        if (this.deviceIsIOSWithBadTarget)","            targetElement = document.elementFromPoint(changedTouch.pageX - window.pageXOffset,","                changedTouch.pageY - window.pageYOffset);","","        targetElement.dispatchEvent(tap);","    }","};",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":13,"column":0},"action":"remove","lines":["// Copyright 2012 Tart. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":24},"end":{"row":2,"column":28},"action":"remove","lines":["tart"]},{"start":{"row":2,"column":24},"end":{"row":2,"column":39},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":52},"end":{"row":5,"column":56},"action":"remove","lines":["tart"]},{"start":{"row":5,"column":52},"end":{"row":5,"column":67},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":90},"end":{"row":6,"column":94},"action":"remove","lines":["tart"]},{"start":{"row":6,"column":90},"end":{"row":6,"column":105},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":37},"end":{"row":13,"column":41},"action":"remove","lines":["tart"]},{"start":{"row":13,"column":37},"end":{"row":13,"column":52},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":14},"end":{"row":19,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":19,"column":14},"end":{"row":19,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":0},"end":{"row":33,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":33,"column":0},"end":{"row":33,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":60},"end":{"row":36,"column":64},"action":"remove","lines":["TART"]},{"start":{"row":36,"column":60},"end":{"row":36,"column":75},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":90},"end":{"row":36,"column":94},"action":"remove","lines":["tart"]},{"start":{"row":36,"column":90},"end":{"row":36,"column":105},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":24},"end":{"row":40,"column":28},"action":"remove","lines":["tart"]},{"start":{"row":40,"column":24},"end":{"row":40,"column":39},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":0},"end":{"row":47,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":47,"column":0},"end":{"row":47,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":0},"end":{"row":51,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":51,"column":0},"end":{"row":51,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":56},"end":{"row":51,"column":60},"action":"remove","lines":["tart"]},{"start":{"row":51,"column":56},"end":{"row":51,"column":71},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":24},"end":{"row":2,"column":39},"action":"remove","lines":["samanthaClosure"]},{"start":{"row":2,"column":24},"end":{"row":2,"column":25},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":25},"end":{"row":2,"column":26},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":26},"end":{"row":2,"column":27},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":27},"end":{"row":2,"column":28},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":63,"column":0},"end":{"row":63,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":99,"column":28},"end":{"row":99,"column":32},"action":"remove","lines":["tart"]},{"start":{"row":99,"column":28},"end":{"row":99,"column":43},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":101,"column":28},"end":{"row":101,"column":32},"action":"remove","lines":["tart"]},{"start":{"row":101,"column":28},"end":{"row":101,"column":43},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":28},"end":{"row":104,"column":32},"action":"remove","lines":["tart"]},{"start":{"row":104,"column":28},"end":{"row":104,"column":43},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":107,"column":28},"end":{"row":107,"column":32},"action":"remove","lines":["tart"]},{"start":{"row":107,"column":28},"end":{"row":107,"column":43},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":120,"column":0},"end":{"row":120,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":120,"column":0},"end":{"row":120,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":134,"column":22},"end":{"row":134,"column":26},"action":"remove","lines":["tart"]},{"start":{"row":134,"column":22},"end":{"row":134,"column":37},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":24},"end":{"row":2,"column":28},"action":"remove","lines":["tart"]},{"start":{"row":2,"column":24},"end":{"row":2,"column":39},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":18},"end":{"row":2,"column":39},"action":"remove","lines":["touchssamanthaClosure"]},{"start":{"row":2,"column":18},"end":{"row":2,"column":28},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":46},"end":{"row":5,"column":67},"action":"remove","lines":["touchssamanthaClosure"]},{"start":{"row":5,"column":46},"end":{"row":5,"column":56},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":84},"end":{"row":6,"column":105},"action":"remove","lines":["touchssamanthaClosure"]},{"start":{"row":6,"column":84},"end":{"row":6,"column":94},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":54},"end":{"row":36,"column":75},"action":"remove","lines":["TOUCHSsamanthaClosure"]},{"start":{"row":36,"column":54},"end":{"row":36,"column":64},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":73},"end":{"row":36,"column":94},"action":"remove","lines":["TouchssamanthaClosure"]},{"start":{"row":36,"column":73},"end":{"row":36,"column":83},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":50},"end":{"row":51,"column":71},"action":"remove","lines":["TouchssamanthaClosure"]},{"start":{"row":51,"column":50},"end":{"row":51,"column":60},"action":"insert","lines":["touchstart"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":50},"end":{"row":51,"column":51},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":50},"end":{"row":51,"column":51},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":54},"end":{"row":36,"column":64},"action":"remove","lines":["touchstart"]},{"start":{"row":36,"column":54},"end":{"row":36,"column":55},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":55},"end":{"row":36,"column":56},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":56},"end":{"row":36,"column":57},"action":"insert","lines":["U"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":57},"end":{"row":36,"column":58},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":58},"end":{"row":36,"column":59},"action":"insert","lines":["H"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":59},"end":{"row":36,"column":60},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":60},"end":{"row":36,"column":61},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":61},"end":{"row":36,"column":62},"action":"insert","lines":["A"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":62},"end":{"row":36,"column":63},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":63},"end":{"row":36,"column":64},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":73},"end":{"row":36,"column":74},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":73},"end":{"row":36,"column":74},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"remove","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"insert","lines":["S"]},{"start":{"row":51,"column":56},"end":{"row":51,"column":57},"action":"remove","lines":["s"]},{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"remove","lines":["S"]},{"start":{"row":51,"column":55},"end":{"row":51,"column":56},"action":"insert","lines":["s"]}]}]]},"ace":{"folds":[],"scrolltop":464,"scrollleft":0,"selection":{"start":{"row":29,"column":0},"end":{"row":29,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":5,"state":"doc-start","mode":"ace/mode/javascript"}},"timestamp":1425190378898,"hash":"3a86046d2761ae10574d252f8a8b432160c3e088"}