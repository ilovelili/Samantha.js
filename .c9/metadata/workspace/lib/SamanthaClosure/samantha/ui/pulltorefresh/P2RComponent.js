{"filter":false,"title":"P2RComponent.js","tooltip":"/lib/SamanthaClosure/samantha/ui/pulltorefresh/P2RComponent.js","undoManager":{"mark":24,"position":24,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":212,"column":0},"action":"insert","lines":["// Copyright 2014 Startup Kitchen. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.","","goog.provide('tart.ui.P2RComponent');","goog.require('goog.async.Throttle');","goog.require('tart.ui.P2RComponentModel');","goog.require('tart.ui.DlgComponent');","","","","/**"," * P2RComponent is a small component which checks the scroll position of a given DOM element, and if it's in"," * an appropriate position, fires a REFRESH event for the parent component to act upon. When the parent component is"," * done with refreshing, it should reset this P2RComponent with the reset() method."," *"," * @constructor"," * @extends {tart.ui.DlgComponent}"," *"," * @param {Element=} opt_el Optional element to track its scroll."," */","tart.ui.P2RComponent = function(opt_el) {","    this.model = new tart.ui.P2RComponentModel();","    this.model.setParentEventTarget(this);","    goog.base(this);","","    this.EventType = this.model.EventType;","","    if (opt_el) this.register(opt_el);","};","goog.inherits(tart.ui.P2RComponent, tart.ui.DlgComponent);","","","/**"," * Threshold value for the release action. Releases after this threshold will trigger a refresh."," *"," * @type {number}"," */","tart.ui.P2RComponent.prototype.threshold = 135;","","","/**"," * Height of this component. This setting is used to offset the scroll view while refreshing."," *"," * @type {number}"," */","tart.ui.P2RComponent.prototype.height = 96;","","","/**"," * Start position of the arrow. This is adjusted for a spring-like effect."," *"," * @type {number}"," */","tart.ui.P2RComponent.prototype.arrowOffset = -40;","","","/**"," * @override"," */","tart.ui.P2RComponent.prototype.bindModelEvents = function() {","    goog.events.listen(this.model, this.model.EventType.SHOULD_REFRESH, this.onShouldRefresh,","        false, this);","};","","","/**"," * Triggered when the components decides a refresh action. This method should be overridden"," * to, for example, display a spinner animation during refresh."," */","tart.ui.P2RComponent.prototype.onShouldRefresh = function() {","    this.el.style.webkitTransform = 'translateY(' + this.height + 'px)';","    this.el.style.webkitTransition = '300ms ease-out';","","    this.getChild(this.mappings.SPINNER)[0].style.visibility = 'visible';","    this.getChild(this.mappings.ARROW)[0].style.visibility = 'hidden';","};","","","/**"," * @override"," */","tart.ui.P2RComponent.prototype.render = function(opt_base, opt_index) {","    goog.base(this, 'render', opt_base, opt_index);","","    this.rendered = true;","","    if (!this.el) this.register(this.getElement().parentNode);","};","","","/**"," * Resets the component state to default. This should be used to signal the end of refreshing so that this component"," * can again check for pull to refresh."," */","tart.ui.P2RComponent.prototype.reset = function() {","    if (this.el) this.el.style.webkitTransform = 'translateY(0)';","","    var spinner = this.getChild(this.mappings.SPINNER);","    var arrow = this.getChild(this.mappings.ARROW);","","    if (spinner) spinner[0].style.visibility = 'hidden';","","    setTimeout(function() {","        if (arrow) arrow[0].style.visibility = 'visible';","    }, 500);","","    this.model.reset();","};","","","/**"," * Registers an element to track its scroll. This can be used for lazily introducing an element to track."," *"," * @param {Node} el Element to track."," */","tart.ui.P2RComponent.prototype.register = function(el) {","    this.reset();","","    this.el = el;","","    goog.events.unlistenByKey(this.scrollListener);","    goog.events.unlistenByKey(this.releaseListener);","","    this.scrollListener = goog.events.listen(el, goog.events.EventType.SCROLL, this.onScroll, false, this);","    this.releaseListener = goog.events.listen(document.body, goog.events.EventType.TOUCHEND,","        this.onRelease_, false, this);","};","","","/**"," * Scroll event handler for pull to refresh."," *"," * @param {goog.events.BrowserEvent} e Scroll event object."," */","tart.ui.P2RComponent.prototype.onScroll = function(e) {","    this.checkShouldRefresh(e);","","    var rot = 0,","        scroll = -e.target.scrollTop,","        pos = this.arrowOffset + Math.pow(scroll, 0.75),","        rotationThreshold = this.threshold - 60;","","    if (scroll >= rotationThreshold)","        rot = Math.min(180, (scroll - rotationThreshold) * 3);","","    this.getChild(this.mappings.ARROW)[0].style.webkitTransform = 'translateY(' + pos + 'px) rotate(' + rot + 'deg)';","};","","","/**"," * Fires when the user lifts her finger to finish the scroll."," * If the user scrolled enough, inform the model to refresh"," *"," * @private"," */","tart.ui.P2RComponent.prototype.onRelease_ = function() {","    if (this.el.scrollTop < -this.threshold)","        this.model.refresh();","};","","","/**"," * If in an appropriate state, checks if the scroll position is right and if so triggers a refresh event."," *"," * @param {goog.events.BrowserEvent} e Scroll event object."," */","tart.ui.P2RComponent.prototype.checkShouldRefresh = function(e) {","    this.model.triggerShouldCheckState();","};","","","/**"," * @override"," */","tart.ui.P2RComponent.prototype.templates_base = function() {","    return '<div id=\"' + this.getId() + '\" class=\"pull-to-refresh\">' +","            '<div class=\"pull-to-refresh-arrow\"></div>' +","            '<div class=\"pull-to-refresh-spinner\"></div>' +","        '</div>';","};","","","/**"," * @override"," */","tart.ui.P2RComponent.prototype.disposeInternal = function() {","    this.model.dispose();","    goog.events.unlistenByKey(this.scrollListener);","","    goog.dom.removeNode(this.getElement());","    goog.base(this, 'disposeInternal');","};","","","/**"," * @enum {string}"," */","tart.ui.P2RComponent.prototype.mappings = {","    ARROW: '.pull-to-refresh-arrow',","    SPINNER: '.pull-to-refresh-spinner'","};",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":13,"column":0},"action":"remove","lines":["// Copyright 2014 Startup Kitchen. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":14},"end":{"row":0,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":0,"column":14},"end":{"row":0,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":14},"end":{"row":2,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":2,"column":14},"end":{"row":2,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":14},"end":{"row":3,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":3,"column":14},"end":{"row":3,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":13},"end":{"row":13,"column":17},"action":"remove","lines":["tart"]},{"start":{"row":13,"column":13},"end":{"row":13,"column":28},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":17,"column":0},"end":{"row":17,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":21},"end":{"row":18,"column":25},"action":"remove","lines":["tart"]},{"start":{"row":18,"column":21},"end":{"row":18,"column":36},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":14},"end":{"row":26,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":26,"column":14},"end":{"row":26,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":47},"end":{"row":26,"column":51},"action":"remove","lines":["tart"]},{"start":{"row":26,"column":47},"end":{"row":26,"column":62},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":34,"column":0},"end":{"row":34,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":0},"end":{"row":42,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":42,"column":0},"end":{"row":42,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":0},"end":{"row":50,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":50,"column":0},"end":{"row":50,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":56,"column":0},"end":{"row":56,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":56,"column":0},"end":{"row":56,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":66,"column":0},"end":{"row":66,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":66,"column":0},"end":{"row":66,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":78,"column":0},"end":{"row":78,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":91,"column":0},"end":{"row":91,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":91,"column":0},"end":{"row":91,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":112,"column":0},"end":{"row":112,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":112,"column":0},"end":{"row":112,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":0},"end":{"row":131,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":131,"column":0},"end":{"row":131,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":152,"column":0},"end":{"row":152,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":152,"column":0},"end":{"row":152,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":163,"column":0},"end":{"row":163,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":163,"column":0},"end":{"row":163,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":171,"column":0},"end":{"row":171,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":171,"column":0},"end":{"row":171,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":182,"column":0},"end":{"row":182,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":182,"column":0},"end":{"row":182,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":194,"column":0},"end":{"row":194,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":194,"column":0},"end":{"row":194,"column":15},"action":"insert","lines":["samanthaClosure"]}]}]]},"ace":{"folds":[],"scrolltop":2900,"scrollleft":0,"selection":{"start":{"row":198,"column":0},"end":{"row":198,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1425207367192,"hash":"24a96fa534f5a47544f78e33c3d8f3e2a3462b29"}