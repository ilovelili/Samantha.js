{"filter":false,"title":"InfiniteScrollComponent.js","tooltip":"/lib/SamanthaClosure/samantha/ui/infinitescroll/InfiniteScrollComponent.js","undoManager":{"mark":20,"position":20,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":152,"column":0},"action":"insert","lines":["// Copyright 2014 Startup Kitchen. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.","","goog.provide('tart.ui.InfiniteScrollComponent');","goog.require('goog.async.Throttle');","goog.require('tart.ui.InfiniteScrollComponentModel');","goog.require('tart.ui.DlgComponent');","","","","/**"," * InfiniteScrollComponent is a small component which checks the scroll position of a given DOM element, and if it's in"," * an appropriate position, fires a LOAD event for the parent component to act upon. When the parent component is"," * done loading new items, it should reset this InfiniteScrollComponent with the reset() method."," *"," * @constructor"," * @extends {tart.ui.DlgComponent}"," *"," * @param {Element=} opt_el Optional element to track its scroll."," */","tart.ui.InfiniteScrollComponent = function(opt_el) {","    this.model = new tart.ui.InfiniteScrollComponentModel();","    this.model.setParentEventTarget(this);","    goog.base(this);","","    this.EventType = this.model.EventType;","    this.throttle = new goog.async.Throttle(this.checkShouldLoadMore_, 100, this);","","    if (opt_el) this.register(opt_el);","};","goog.inherits(tart.ui.InfiniteScrollComponent, tart.ui.DlgComponent);","","","/**"," * Message to show when no more items are available to load."," *"," * @type {string}"," */","tart.ui.InfiniteScrollComponent.prototype.endOfListText = '';","","","/**"," * @override"," */","tart.ui.InfiniteScrollComponent.prototype.render = function(opt_base, opt_index) {","    goog.base(this, 'render', opt_base, opt_index);","","    if (!this.el) this.register(this.getElement().parentNode);","};","","","/**"," * Resets the component state to default. This should be used to signal the end of loading so that this component"," * can again check for loading."," */","tart.ui.InfiniteScrollComponent.prototype.reset = function() {","    this.model.reset();","};","","","/**"," * Registers an element to track its scroll. This can be used for lazily introducing an element to track."," *"," * @param {Node} el Element to track."," */","tart.ui.InfiniteScrollComponent.prototype.register = function(el) {","    this.reset();","","    this.el = el;","","    goog.events.unlistenByKey(this.scrollListener);","    this.scrollListener = goog.events.listen(el, goog.events.EventType.SCROLL, this.onScroll_, false, this);","};","","","/**"," * Scroll event handler for infinite scroll. Fires the throttle to check for the correct load more position."," *"," * @private"," */","tart.ui.InfiniteScrollComponent.prototype.onScroll_ = function() {","    this.throttle.fire();","};","","","/**"," * If in an appropriate state, checks if the scroll position is right and if so triggers a load more event."," *"," * @private"," */","tart.ui.InfiniteScrollComponent.prototype.checkShouldLoadMore_ = function() {","    this.model.triggerShouldCheckState();","    if (!this.model.shouldCheck()) return;","","    var el = this.el;","    if (!el) return;","","    if (el.scrollHeight > el.offsetHeight && // the element can actually scroll","        el.scrollTop > el.scrollHeight - el.offsetHeight - 400) // and we're in a good position to load more","        this.model.load();","};","","","/**"," * Shows spinner during load."," */","tart.ui.InfiniteScrollComponent.prototype.showSpinner = function() {","    this.getElement().classList.add('spinner');","    this.getElement().innerText = '';","    this.reset();","};","","","/**"," * Shows end of list message if no more items are available."," */","tart.ui.InfiniteScrollComponent.prototype.showEndOfList = function() {","    this.getElement().innerText = this.endOfListText;","    this.getElement().classList.remove('spinner');","};","","","/**"," * @override"," */","tart.ui.InfiniteScrollComponent.prototype.templates_base = function() {","    return '<div id=\"' + this.getId() + '\" class=\"inf-scroll\"></div>';","};","","","/**"," * @override"," */","tart.ui.InfiniteScrollComponent.prototype.disposeInternal = function() {","    this.model.dispose();","    this.throttle.dispose();","    goog.events.unlistenByKey(this.scrollListener);","","    goog.dom.removeNode(this.getElement());","    goog.base(this, 'disposeInternal');","};",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":13,"column":0},"action":"remove","lines":["// Copyright 2014 Startup Kitchen. All Rights Reserved.","//","// Licensed under the Apache License, Version 2.0 (the \"License\");","// you may not use this file except in compliance with the License.","// You may obtain a copy of the License at","//","//      http://www.apache.org/licenses/LICENSE-2.0","//","// Unless required by applicable law or agreed to in writing, software","// distributed under the License is distributed on an \"AS-IS\" BASIS,","// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","// See the License for the specific language governing permissions and","// limitations under the License.",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":14},"end":{"row":0,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":0,"column":14},"end":{"row":0,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":14},"end":{"row":2,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":2,"column":14},"end":{"row":2,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":14},"end":{"row":3,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":3,"column":14},"end":{"row":3,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":13},"end":{"row":13,"column":17},"action":"remove","lines":["tart"]},{"start":{"row":13,"column":13},"end":{"row":13,"column":28},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":17,"column":0},"end":{"row":17,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":21},"end":{"row":18,"column":25},"action":"remove","lines":["tart"]},{"start":{"row":18,"column":21},"end":{"row":18,"column":36},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":14},"end":{"row":27,"column":18},"action":"remove","lines":["tart"]},{"start":{"row":27,"column":14},"end":{"row":27,"column":29},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":58},"end":{"row":27,"column":62},"action":"remove","lines":["tart"]},{"start":{"row":27,"column":58},"end":{"row":27,"column":73},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":0},"end":{"row":35,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":35,"column":0},"end":{"row":35,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":0},"end":{"row":41,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":41,"column":0},"end":{"row":41,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":0},"end":{"row":52,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":52,"column":0},"end":{"row":52,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":0},"end":{"row":62,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":62,"column":0},"end":{"row":62,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":0},"end":{"row":77,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":77,"column":0},"end":{"row":77,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":0},"end":{"row":87,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":87,"column":0},"end":{"row":87,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":0},"end":{"row":103,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":103,"column":0},"end":{"row":103,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":113,"column":0},"end":{"row":113,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":0},"end":{"row":122,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":122,"column":0},"end":{"row":122,"column":15},"action":"insert","lines":["samanthaClosure"]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":0},"end":{"row":130,"column":4},"action":"remove","lines":["tart"]},{"start":{"row":130,"column":0},"end":{"row":130,"column":15},"action":"insert","lines":["samanthaClosure"]}]}]]},"ace":{"folds":[],"scrolltop":1748,"scrollleft":0,"selection":{"start":{"row":131,"column":25},"end":{"row":131,"column":25},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":67,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1425196236143,"hash":"a2ccc01539c6e402774ef646b9fa14f54f647b17"}